# üîç Module X-Ray - AccessWeaver Infrastructure

**Version :** 1.0  
**Date :** Juin 2025  
**Module :** modules/xray  
**Responsable :** √âquipe Platform AccessWeaver

---

## üîß Configuration Terraform

### Structure du Module

Le module X-Ray impl√©mente une solution compl√®te de trac√© distribu√© avec la structure suivante :

```hcl
modules/
‚îî‚îÄ‚îÄ xray/
    ‚îú‚îÄ‚îÄ main.tf            # Configuration principale d'X-Ray
    ‚îú‚îÄ‚îÄ variables.tf       # D√©claration des variables d'entr√©e
    ‚îú‚îÄ‚îÄ outputs.tf         # Sorties du module
    ‚îú‚îÄ‚îÄ iam.tf             # R√¥les IAM et politiques pour X-Ray
    ‚îú‚îÄ‚îÄ daemon.tf          # Configuration du daemon X-Ray
    ‚îú‚îÄ‚îÄ sampling.tf        # R√®gles d'√©chantillonnage
    ‚îú‚îÄ‚îÄ groups.tf          # Groupes X-Ray et filtres
    ‚îî‚îÄ‚îÄ monitoring.tf      # Int√©gration CloudWatch
```

### Utilisation du Module

```hcl
module "xray" {
  source = "../../modules/xray"
  
  environment                  = "production"
  sampling_rate                = 0.2
  error_sampling_rate          = 1.0
  encryption_key_id            = module.kms.xray_key_id
  trace_retention_in_days      = 30
  
  # Configuration des groupes de trac√©
  enable_custom_groups         = true
  error_group_filter_expression = "error = true"
  latency_group_filter_expression = "responsetime > 1"
  
  # Int√©gration avec daemon
  daemon_image                 = "amazon/aws-xray-daemon:latest"
  daemon_cpu                   = 256
  daemon_memory                = 512
  
  # Monitoring
  create_dashboard             = true
  enable_insights              = true
  create_alarms                = true
  alarm_sns_topic_arn          = module.monitoring.alert_topic_arn
  
  tags = {
    Project     = "AccessWeaver"
    Environment = "production"
    Managed     = "terraform"
  }
}
```

### Variables d'Entr√©e Principales

| Nom Variable | Type | Description | D√©faut |
|--------------|------|-------------|--------|
| `environment` | string | Environnement de d√©ploiement | `"development"` |
| `sampling_rate` | number | Taux d'√©chantillonnage global | `1.0` |
| `error_sampling_rate` | number | Taux d'√©chantillonnage pour les erreurs | `1.0` |
| `encryption_key_id` | string | ID de cl√© KMS pour le chiffrement | `null` |
| `trace_retention_in_days` | number | Dur√©e de conservation des traces | `7` |
| `enable_custom_groups` | bool | Activer les groupes personnalis√©s | `false` |
| `create_dashboard` | bool | Cr√©er un dashboard CloudWatch | `true` |
| `create_alarms` | bool | Cr√©er des alarmes CloudWatch | `false` |
| `alarm_sns_topic_arn` | string | ARN du topic SNS pour les alertes | `null` |

### Ressources AWS Cr√©√©es

```hcl
# R√®gle d'√©chantillonnage X-Ray
resource "aws_xray_sampling_rule" "custom" {
  rule_name      = "${var.environment}-default-sampling"
  priority       = 1000
  version        = 1
  reservoir_size = 1
  fixed_rate     = var.sampling_rate
  url_path       = "*"
  host           = "*"
  http_method    = "*"
  service_name   = "*"
  service_type   = "*"
  
  attributes = {
    environment = var.environment
  }
}

# Groupe X-Ray pour les erreurs
resource "aws_xray_group" "errors" {
  count       = var.enable_custom_groups ? 1 : 0
  group_name  = "${var.environment}-errors"
  filter_expression = var.error_group_filter_expression
}

# R√¥le IAM pour le daemon X-Ray
resource "aws_iam_role" "xray_daemon" {
  name = "${var.environment}-xray-daemon-role"
  
  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = "sts:AssumeRole"
        Effect = "Allow"
        Principal = {
          Service = "ecs-tasks.amazonaws.com"
        }
      }
    ]
  })
}

# Dashboard CloudWatch pour X-Ray
resource "aws_cloudwatch_dashboard" "xray" {
  count          = var.create_dashboard ? 1 : 0
  dashboard_name = "${var.environment}-xray-monitoring"
  
  dashboard_body = jsonencode({
    widgets = [
      {
        type   = "metric"
        x      = 0
        y      = 0
        width  = 12
        height = 6
        properties = {
          metrics = [
            ["AWS/XRay", "Traces", "ServiceType", "AWS::ApiGateway::Stage"],
            ["AWS/XRay", "Traces", "ServiceType", "AWS::Lambda::Function"],
            ["AWS/XRay", "Traces", "ServiceType", "AWS::DynamoDB::Table"]
          ],
          view    = "timeSeries",
          stacked = false,
          title   = "Traces par Service"
        }
      }
      # Autres widgets...
    ]
  })
}
```

### Outputs du Module

| Nom | Description |
|-----|-------------|
| `sampling_rule_arns` | ARNs des r√®gles d'√©chantillonnage cr√©√©es |
| `xray_group_arns` | ARNs des groupes X-Ray cr√©√©s |
| `daemon_role_arn` | ARN du r√¥le IAM pour le daemon X-Ray |
| `dashboard_arn` | ARN du dashboard CloudWatch (si cr√©√©) |
| `xray_policy_json` | JSON de la politique IAM pour l'int√©gration X-Ray |

---

## üîó Int√©gration des Applications

### Installation des D√©pendances

#### Java / Spring Boot

```xml
<!-- pom.xml -->
<dependencies>
  <!-- AWS X-Ray SDK pour Java -->
  <dependency>
    <groupId>com.amazonaws</groupId>
    <artifactId>aws-xray-recorder-sdk-core</artifactId>
    <version>2.11.0</version>
  </dependency>
  
  <!-- Int√©gration Spring Boot -->
  <dependency>
    <groupId>com.amazonaws</groupId>
    <artifactId>aws-xray-recorder-sdk-spring</artifactId>
    <version>2.11.0</version>
  </dependency>
  
  <!-- Int√©gration SQL -->
  <dependency>
    <groupId>com.amazonaws</groupId>
    <artifactId>aws-xray-recorder-sdk-sql</artifactId>
    <version>2.11.0</version>
  </dependency>
  
  <!-- Int√©gration AWS SDK -->
  <dependency>
    <groupId>com.amazonaws</groupId>
    <artifactId>aws-xray-recorder-sdk-aws-sdk</artifactId>
    <version>2.11.0</version>
  </dependency>
</dependencies>
```

### Configuration Spring Boot

```java
// XRayConfig.java
@Configuration
public class XRayConfig {

    @Bean
    public Filter xrayFilter() {
        return new AWSXRayServletFilter("accessweaver-service");
    }
    
    static {
        AWSXRayRecorderBuilder builder = AWSXRayRecorderBuilder.standard()
            .withSegmentListener(new SLF4JSegmentListener())
            .withPlugin(new EC2Plugin())
            .withPlugin(new ECSPlugin());
        
        if (isProduction()) {
            builder.withSamplingStrategy(new CentralizedSamplingStrategy());
        }
        
        AWSXRay.setGlobalRecorder(builder.build());
    }
    
    private static boolean isProduction() {
        return "production".equals(System.getenv("ENVIRONMENT"));
    }
}
```

```java
// Application.java
@SpringBootApplication
@RestController
@EnableXRay  // Activer l'instrumentation X-Ray
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
    
    @GetMapping("/api/data")
    public ResponseEntity<Data> getData() {
        // Ajouter des annotations personnalis√©es
        Segment segment = AWSXRay.getCurrentSegment();
        segment.putAnnotation("environment", System.getenv("ENVIRONMENT"));
        segment.putAnnotation("version", "1.0.0");
        
        // Ajouter des m√©tadonn√©es
        segment.putMetadata("metadata_key", "metadata_value");
        
        // Sous-segment pour op√©ration sp√©cifique
        Subsegment subsegment = AWSXRay.beginSubsegment("getData-processing");
        try {
            Data result = processData();
            return ResponseEntity.ok(result);
        } catch (Exception e) {
            subsegment.addException(e);
            throw e;
        } finally {
            AWSXRay.endSubsegment();
        }
    }
    
    private Data processData() {
        // Logique m√©tier
        return new Data();
    }
}
```

### Configuration pour Lambda

```java
// Handler.java
import com.amazonaws.xray.entities.Subsegment;
import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestHandler;
import com.amazonaws.xray.AWSXRay;

public class Handler implements RequestHandler<APIGatewayProxyRequestEvent, APIGatewayProxyResponseEvent> {

    @Override
    public APIGatewayProxyResponseEvent handleRequest(APIGatewayProxyRequestEvent input, Context context) {
        // X-Ray est automatiquement activ√© pour Lambda, ajouter des annotations personnalis√©es
        Subsegment subsegment = AWSXRay.beginSubsegment("handleRequest-processing");
        
        try {
            subsegment.putAnnotation("path", input.getPath());
            subsegment.putAnnotation("httpMethod", input.getHttpMethod());
            
            // Traitement de la requ√™te
            return processRequest(input);
        } catch (Exception e) {
            subsegment.addException(e);
            throw e;
        } finally {
            AWSXRay.endSubsegment();
        }
    }
    
    private APIGatewayProxyResponseEvent processRequest(APIGatewayProxyRequestEvent input) {
        // Logique m√©tier
        return new APIGatewayProxyResponseEvent().withStatusCode(200);
    }
}
```

### Bonnes Pratiques d'Instrumentation

1. **D√©coupe en sous-segments** : Cr√©er des sous-segments pour les op√©rations significatives (appels DB, API externes)
2. **Annotations pertinentes** : Ajouter des annotations permettant le filtrage efficace des traces
3. **Capture d'exceptions** : Toujours enregistrer les exceptions dans les segments
4. **M√©tadonn√©es contextuelles** : Enrichir les segments avec des m√©tadonn√©es m√©tier
5. **Gestion des segments asynchrones** : Utiliser les entit√©s sp√©cifiques pour le code asynchrone
6. **Traces personnalis√©es** : Utiliser `AWSXRay.beginSegment()` et `AWSXRay.endSegment()` pour le code non-web
7. **√âviter l'over-instrumentation** : Ne pas instrumenter les m√©thodes trop petites ou trop fr√©quemment appel√©es

---

## üìä Monitoring et Troubleshooting

### Dashboard de Monitoring X-Ray

Le module cr√©e automatiquement un dashboard CloudWatch pour la visualisation des m√©triques X-Ray :

| Widget | M√©triques | Description |
|--------|-----------|-------------|
| **Traces par Service** | `AWS/XRay/Traces` | Nombre de traces segment√©es par type de service |
| **Latence par Service** | `AWS/XRay/ResponseTime` | Temps de r√©ponse moyen par service |
| **Erreurs par Service** | `AWS/XRay/ErrorRate` | Taux d'erreur segment√© par service |
| **Throttling par Service** | `AWS/XRay/ThrottleCount` | Nombre d'op√©rations limit√©es par AWS |
| **Utilisation X-Ray** | `AWS/XRay/SegmentCount` | Volume de segments trait√©s par X-Ray |

### Alarmes CloudWatch

Les alarmes suivantes sont configur√©es par d√©faut en production :

| Alarme | Condition | S√©v√©rit√© | Action |
|--------|-----------|----------|--------|
| **Erreurs API √©lev√©es** | Taux d'erreur > 5% pendant 5 min | Haute | Notification SNS + PagerDuty |
| **Latence √©lev√©e** | P95 > 1000ms pendant 10 min | Moyenne | Notification SNS |
| **Throttling X-Ray** | > 10 throttles en 5 min | Basse | Notification SNS |
| **Traces perdues** | SegmentSendingErrors > 0 | Moyenne | Notification SNS |

### Expressions de Filtrage X-Ray

Voici quelques expressions de filtrage utiles pour le troubleshooting :

```
# Requ√™tes avec erreurs HTTP 5xx
http.status >= 500

# Requ√™tes lentes (> 2 secondes)
responsetime > 2

# Requ√™tes sp√©cifiques √† un service ayant √©chou√©
service("auth-service") AND error = true

# Requ√™tes contenant des exceptions sp√©cifiques
exception.message CONTAINS "OutOfMemory"

# Requ√™tes avec latence √©lev√©e sur DynamoDB
service("AWS::DynamoDB") AND responsetime > 0.1

# Toutes les erreurs d'un utilisateur sp√©cifique
annotation.userId = "12345" AND error = true
```

### Guide de R√©solution des Probl√®mes

#### 1. Traces manquantes

**Sympt√¥mes** : Aucune donn√©e visible dans la console X-Ray

**Solutions** :
- V√©rifier que le daemon X-Ray est en cours d'ex√©cution
- Confirmer que les IAM permissions sont correctes
- V√©rifier l'instrumentation du code (SDK configur√© correctement)
- Examiner les logs du daemon X-Ray pour d√©tecter les erreurs

**Commande utile** :
```bash
# V√©rifier les logs du daemon X-Ray
aws logs get-log-events --log-group-name /ecs/xray-daemon --log-stream-name ecs/xray-daemon/{INSTANCE_ID}
```

#### 2. Performances d√©grad√©es

**Analyse avec X-Ray** :
1. Consulter la carte des services pour identifier les goulots d'√©tranglement
2. Utiliser l'expression `responsetime > 1` pour filtrer les requ√™tes lentes
3. Examiner les sous-segments pour identifier les op√©rations co√ªteuses
4. V√©rifier les annotations et m√©tadonn√©es pour le contexte des requ√™tes lentes

**Optimisations courantes** :
- Optimiser les requ√™tes de base de donn√©es identifi√©es comme lentes
- Configurer le caching pour les op√©rations fr√©quentes
- Augmenter les ressources des services surcharg√©s
- R√©duire les d√©pendances entre services si possible

#### 3. Erreurs en cascade

**D√©tection** : Utiliser la carte des services pour identifier les services d√©faillants qui impactent d'autres services

**Mitigation** :
- Impl√©menter des politiques de retry avec backoff exponentiel
- Configurer des circuit breakers pour isoler les services d√©faillants
- D√©finir des timeouts appropri√©s pour √©viter le blocage des ressources
- Ajouter des fallbacks pour les services critiques

### Rapports Op√©rationnels

Le module fournit des scripts pour g√©n√©rer des rapports p√©riodiques sur les performances :

```bash
#!/bin/bash
# Script de g√©n√©ration de rapport hebdomadaire X-Ray

# Extraction des donn√©es X-Ray via AWS CLI
aws xray get-group --group-name "production-errors" > /tmp/xray-group.json

# Requ√™te des traces pour la semaine
END_TIME=$(date +%s)
START_TIME=$(date -d "7 days ago" +%s)

aws xray get-trace-summaries \
  --start-time $START_TIME \
  --end-time $END_TIME \
  --filter-expression "service(\"accessweaver-*\")" \
  > /tmp/trace-summary.json

# G√©n√©ration du rapport HTML avec statistiques
python3 /opt/scripts/generate-xray-report.py \
  --input /tmp/trace-summary.json \
  --template /opt/templates/weekly-report.html \
  --output /var/www/reports/xray-week-$(date +%Y%m%d).html

# Notification par email
aws ses send-email \
  --source reports@accessweaver.com \
  --destination file://report-recipients.json \
  --message file://email-with-report-link.json
```

---

## üèóÔ∏è Architecture et Impl√©mentation

### Strat√©gie par Environnement

| Aspect | Development | Staging | Production |
|--------|-------------|---------|------------|
| **üîç Niveau de trac√©** | D√©taill√© (100%) | √âchantillonn√© (50%) | S√©lectif (20% + 100% erreurs) |
| **‚è∞ R√©tention des traces** | 7 jours | 14 jours | 30 jours |
| **üîê Encryption** | Standard | KMS | KMS avec clefs d√©di√©es |
| **üíº Groupes** | Base | Base + API | Base + API + M√©tier |
| **üîé Insights** | D√©sactiv√© | Erreurs uniquement | Complet avec anomalies |
| **üìà M√©triques** | Basiques | Standard | Avanc√©es |
| **üìÑ Journalisation** | DEBUG | INFO | WARNING en normal, DEBUG en incident |

### Composants Principaux

Le module X-Ray d√©ploie et configure les composants suivants :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                           ‚îÇ
‚îÇ             AWS X-Ray - Composants D√©ploy√©s                ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                  Daemon X-Ray                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - D√©ploy√© sur ECS en sidecar                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Configur√© via ConfigMap (Kubernetes)             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Gestion du buffering et de la retransmission      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                  Groupes X-Ray                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Groupes par services et APIs                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Expressions de filtrage personnalis√©es           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - R√®gles de d√©tection d'anomalies                  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              R√¥les IAM et Politiques                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - R√¥le pour daemon X-Ray                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - R√¥les pour services instrumentalis√©s             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Politiques de moindre privil√®ge                   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ               Int√©gration Monitoring                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Dashboard CloudWatch                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Alarmes sur latences et taux d'erreurs            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Int√©gration avec services d'alerting              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Configuration des Services

Le module X-Ray configure tous les services AccessWeaver pour une instrumentalisation optimale :

| Service | Niveau d'Instrumentation | D√©tails |
|---------|--------------------------|----------|
| **API Gateway** | Complet | Traces pour toutes les requ√™tes API, annotations pour authentification |
| **Lambda** | Complet | Trac√© automatique, ajout de m√©tadonn√©es personnalis√©es |
| **ECS Services** | Application | Instrumentation via SDK Spring Boot, annotations m√©tier |
| **DynamoDB** | Client | Trac√© automatique des op√©rations DynamoDB |
| **RDS** | Personnalis√© | SQL queries captur√©es au niveau application |
| **ElastiCache** | Basique | M√©triques de latence sur op√©rations cl√©s |
| **S3** | Basique | Trac√© des op√©rations PUT/GET/DELETE sur objets |

---
## üéØ Vue d'Ensemble

### Objectif Principal
Le module X-Ray fournit une solution compl√®te de **trac√© distribu√© et d'analyse des performances** pour l'ensemble des services et applications de la plateforme AccessWeaver. Il impl√©mente AWS X-Ray, un service qui collecte des donn√©es sur les requ√™tes trait√©es par l'application et fournit des outils pour visualiser, filtrer et comprendre ces donn√©es afin d'identifier les probl√®mes et les opportunit√©s d'optimisation.

### Concept de Trac√© Distribu√©

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                           ‚îÇ
‚îÇ             AWS X-Ray - Trac√© Distribu√©                    ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                   ‚îÇ
‚îÇ  ‚îÇ Utilisateur    ‚îÇ‚îÄ‚Üí‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÄ‚Üí‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÄ‚Üí‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ API Gateway   ‚îÇ   ‚îÇ Service A     ‚îÇ   ‚îÇ Service B     ‚îÇ  ‚îÇ
‚îÇ                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                           ‚Üì                ‚Üì                ‚Üì            ‚îÇ
‚îÇ                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ                      ‚îÇ   Lambda     ‚îÇ‚îÄ‚Üí‚îÇ DynamoDB     ‚îÇ   ‚îÇ RDS DB       ‚îÇ  ‚îÇ
‚îÇ                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ                          X-Ray Daemon                       ‚îÇ
‚îÇ                               ‚Üì                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                 AWS X-Ray Service                     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                               ‚Üì                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Traces & Segments    ‚îÇ   ‚îÇ Service Map         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Caract√©ristiques Principales

- **Trac√© end-to-end** : Suivi des requ√™tes depuis l'utilisateur jusqu'aux bases de donn√©es
- **Cartographie des services** : Visualisation graphique des relations entre services
- **Analyse des performances** : Identification des goulots d'√©tranglement et des latences
- **D√©tection d'anomalies** : Identification des erreurs et comportements anormaux
- **Int√©gration compl√®te** : Compatible avec tous les services AWS et applications personnalis√©es
- **Filtrage avanc√©** : Expressions de filtrage pour analyser des segments sp√©cifiques
- **Alertes automatiques** : Int√©gration avec CloudWatch pour la surveillance proactive
- **Personnalisation des traces** : Annotations et m√©tadonn√©es pour enrichir les informations collect√©es

---